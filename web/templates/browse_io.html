{% extends 'layouts/master-page.html' %}
{% block title %}Vendor browsing{% endblock %}
{% block head %}
    <!-- SocketIO -->
    <script type="text/javascript" src="{{ url_for('static', filename='js/socket.io.js') }}"></script>
   <script type="text/javascript" charset="utf-8">
        namespace = '/cve_search';

            // Connect to the Socket.IO server.
            // The connection URL has the following format, relative to the current page:
            //     http[s]://<domain>:<port>[/<namespace>]
        var socket = io(namespace);

        $(document).ready(function() {

            var sources = []

            // Event handler for new connections.
            // The callback function is invoked when a connection with the
            // server is established.
            socket.on('connect', function() {
                //var con_stat = document.getElementById("con_status");
                //con_stat.classList.remove("badge-danger");
                //con_stat.classList.add("badge-success");
                socket.emit('async_mode');
            });

            socket.on('disconnect', function() {
                //var con_stat = document.getElementById("con_status");
                //con_stat.classList.remove("badge-success");
                //con_stat.classList.add("badge-danger");
                //$('#async_mode').text("NA");
                //$('#ping-pong').text("NA ");
            });

            // Event handler for server sent data.
            // The callback function is invoked whenever the server emits data
            // to the client.
            socket.on('process_data', function(msg, cb) {

                var data = JSON.parse(msg);

                console.log(data);

                //<tr>
                //  <td><a href="/browse/..">...</a></td>
                //</tr>

                var tableRef = document.getElementById('vendorTable').getElementsByTagName('tbody')[0];

                // Insert a row in the table at row index 0
                var newRow   = tableRef.insertRow(tableRef.rows.length);

                // Insert a cell in the row at index 0
                var newCell  = newRow.insertCell(0);

                //var row = document.createElement("tr");

                //var cell = document.createElement("td");
                //row.appendChild(cell)

                var ref = document.createElement("a");
                ref.href = "/browse/" + data.vendor;
                newCell.appendChild(ref)

                var textref = document.createTextNode(data);
                ref.appendChild(textref);

                //var output = document.getElementById("output");
                //output.insertBefore(row, output.childNodes[0]);

                if (cb) {
                    cb();
                }
            });

            socket.on('con_request', function(msg, cb) {

                if (cb) {
                    cb();
                }
            });

        });
    </script>
{% endblock %}
{% block content %}
  <!-- breadcrumb -->
{% include 'subpages/breadcrumbs.html' %}
  <!-- browse -->
  <table id="vendorTable" class="table table-hover table-striped">
    <thead class="thead-dark">
      <tr>
          <th>
            Vendors
          </th>
      </tr>
    </thead>
    <tbody>

    </tbody>
  </table>
{% endblock %}
