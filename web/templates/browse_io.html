{% extends 'layouts/master-page.html' %}
{% block title %}Vendor browsing{% endblock %}
{% block head %}
    <!-- SocketIO -->
    <script type="text/javascript" src="{{ url_for('static', filename='js/socket.io.js') }}"></script>
   <script type="text/javascript" charset="utf-8">
        namespace = '/lumberjack';

            // Connect to the Socket.IO server.
            // The connection URL has the following format, relative to the current page:
            //     http[s]://<domain>:<port>[/<namespace>]
        var socket = io(namespace);

        $(document).ready(function() {

            var sources = []

            // Event handler for new connections.
            // The callback function is invoked when a connection with the
            // server is established.
            socket.on('connect', function() {
                var con_stat = document.getElementById("con_status");
                con_stat.classList.remove("badge-danger");
                con_stat.classList.add("badge-success");
                socket.emit('async_mode');
            });

            socket.on('disconnect', function() {
                var con_stat = document.getElementById("con_status");
                con_stat.classList.remove("badge-success");
                con_stat.classList.add("badge-danger");
                $('#async_mode').text("NA");
                $('#ping-pong').text("NA ");
            });

            // Event handler for server sent data.
            // The callback function is invoked whenever the server emits data
            // to the client.
            socket.on('process_data', function(msg, cb) {

                var data = JSON.parse(msg);

                var data_entry = document.createElement("DIV");
                data_entry.className = "data_entry";

                var row = document.createElement("DIV");
                row.className = "row";
                data_entry.appendChild(row)

                var id = document.createElement("DIV");
                id.className = "col-md-2";
                row.appendChild(id)

                var textid = document.createTextNode(data.cursor + ': ' + data.id);
                id.appendChild(textid);

                var toa = document.createElement("DIV");
                toa.className = "col-md-2 row_entry_center";
                row.appendChild(toa)

                var ts = new Date(data.TOA * 1000)

                var texttoa = document.createTextNode(ts.toJSON());
                toa.appendChild(texttoa);

                var source = document.createElement("DIV");
                source.className = "col-md-2 row_entry_center row_entry_wrap";
                row.appendChild(source)

                var textsource = document.createTextNode(data.source);
                source.appendChild(textsource);

                var message = document.createElement("DIV");
                message.className = "col-md-6 row_entry_wrap";

                var tree = jsonTree.create(data.message, message);
                tree.expand(function(node) {
                   return node.childNodes.length < 2;
                });

                row.appendChild(message)

                var output = document.getElementById("output");
                output.insertBefore(data_entry, output.childNodes[0]);

                if (cb) {
                    cb();
                }
            });

            socket.on('con_request', function(msg, cb) {

                if (cb) {
                    cb();
                }
            });

        });
    </script>
{% endblock %}
{% block content %}
  <!-- breadcrumb -->
{% include 'subpages/breadcrumbs.html' %}
  <!-- browse -->
  <table id="vendorTable" class="table table-hover table-striped">
    <thead class="thead-dark">
      <tr>
        {% if product != None %}
          <th>
            Products for {{ vendor|htmlDecode }}
          </th>
        {% elif product == None %}
          <th>
            Vendors
          </th>
        {% endif %}
      </tr>
    </thead>
    <tbody>

    </tbody>
  </table>
{% endblock %}
