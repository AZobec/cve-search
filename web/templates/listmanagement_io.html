{% extends 'layouts/master-page.html' %}
{% block title %} Admin listmanagement {% endblock %}
{% block head %}
<!-- css -->
  <link href="/static/css/custom/admin.css" rel="stylesheet" />

  <script type="text/javascript" src="/static/js/custom/list.js"></script>
  <script type="text/javascript" src="/static/js/custom/listmanagement.js"></script>

    <!-- SocketIO -->
    <script type="text/javascript" src="{{ url_for('static', filename='js/socket.io.js') }}"></script>
   <script type="text/javascript" charset="utf-8">
        namespace = '/cve_search';

            // Connect to the Socket.IO server.
            // The connection URL has the following format, relative to the current page:
            //     http[s]://<domain>:<port>[/<namespace>]
        var socket = io(namespace);

        $(document).ready(function() {

            var sources = []

            // Event handler for new connections.
            // The callback function is invoked when a connection with the
            // server is established.
            socket.on('connect', function() {
                //var con_stat = document.getElementById("con_status");
                //con_stat.classList.remove("badge-danger");
                //con_stat.classList.add("badge-success");
                socket.emit('async_mode');
            });

            socket.on('disconnect', function() {
                //var con_stat = document.getElementById("con_status");
                //con_stat.classList.remove("badge-success");
                //con_stat.classList.add("badge-danger");
                //$('#async_mode').text("NA");
                //$('#ping-pong').text("NA ");
            });

            // Event handler for server sent data.
            // The callback function is invoked whenever the server emits data
            // to the client.
            socket.on('process_data', function(msg, cb) {

                var data = JSON.parse(msg);

                var tableRef = document.getElementById('vendorTable').getElementsByTagName('tbody')[0];

                for (i=0; i < data.length; i++) {
                    // Insert a row in the table at row index 0
                    var newRow   = tableRef.insertRow(tableRef.rows.length);

                    // Insert a cell in the row at index 0
                    var newCell  = newRow.insertCell(0);

                    var ref = document.createElement("a");
                    ref.href = "/admin/listmanagement/" + data[i];
                    newCell.appendChild(ref)

                    var textref = document.createTextNode(data[i]);
                    ref.appendChild(textref);

                    var WLCell = newRow.insertCell(1);

                    var WLRef = document.createElement("a");
                    WLRef.href = "javascript:addCPE('whitelist','" + data[i] + "')"

                    var WLFA = document.createElement("i");
                    WLFA.className = "far fa-eye"
                    WLRef.appendChild(WLFA)

                    var WLtextref = document.createTextNode(" whitelist");
                    WLRef.appendChild(WLtextref);

                    WLCell.appendChild(WLRef)

                    var BLCell = newRow.insertCell(2);

                    var BLRef = document.createElement("a");
                    BLRef.href = "javascript:addCPE('whitelist','" + data[i] + "')"

                    var BLFA = document.createElement("i");
                    BLFA.className = "far fa-eye-slash"
                    BLRef.appendChild(BLFA)

                    var BLtextref = document.createTextNode(" blacklist");
                    BLRef.appendChild(BLtextref);

                    BLCell.appendChild(BLRef)
                }

                if (cb) {
                    cb();
                }
            });

            socket.on('con_request', function(msg, cb) {

                if (cb) {
                    cb();
                }
            });

        });
    </script>
{% endblock %}
{% block content %}
  <!-- breadcrumb -->
{% include 'subpages/breadcrumbs.html' %}
  <!-- vendor/product/version -->
  <table id="vendorTable" class="table table-hover table-striped">
    <thead class="thead-dark">
      <tr class="warning">
        <th colspan="3">
            Vendors
        </th>
      </tr>
    </thead>
    <tbody>

    </tbody>
  </table>
{% endblock %}
