#!/usr/bin/env python3
# -*- coding: utf-8 -*-
#
# Script to check and ensure that the recommended index are created as recommended.
#
# Software is free software released under the "Modified BSD license"
#
# Copyright (c) 2014 	psychedelys
# Copyright (c) 2015 	Pieter-Jan Moreels - pieterjan.moreels@gmail.com

# Imports
import os
runPath = os.path.dirname(os.path.realpath(__file__))

import pymongo

import traceback
import configparser

# config
Config = configparser.ConfigParser()
Config.read(os.path.join(runPath, "./configuration.ini"))
# default config
mongoHost = 'localhost'
mongoPort = 27017
mongoDB = "cvedb"
# read config from file
if ("Host" in Config['Mongo']) and (Config.get("Mongo", "Host")!=""):
    mongoHost = Config.get("Mongo", "Host")
if ("Port" in Config['Mongo']) and (Config.get("Mongo", "Port")!=""):
    mongoPort = int(Config.get("Mongo", "Port"))
if ("DB" in Config['Mongo']) and (Config.get("Mongo", "DB")!=""):
    mongoDB = Config.get("Mongo", "DB")

connect = pymongo.MongoClient(mongoHost, mongoPort)
db = connect[mongoDB]

try:
  db.cpe.ensure_index( 'id' )
  print('success to create index on cpe')
except Exception:
  print('failed to create index on cpe')
  traceback.print_exc()
  print('=======')
  pass

try:
  db.cpeother.ensure_index( 'id' )
  print('success to create index on cpeother')
except Exception:
  print('failed to create index on cpeother')
  traceback.print_exc()
  print('=======')
  pass

try:
  db.cves.ensure_index( 'id' )
  print('success to create index on cves')
except Exception:
  print('failed to create index on cves')
  traceback.print_exc()
  print('=======')
  pass

try:
  db.cves.ensure_index( 'vulnerable_configuration' )
  print('success to create index on cves vulnerable_configuration')
except Exception:
  print('failed to create index on cves vulnerable_configuration')
  traceback.print_exc()
  print('=======')
  pass

try:
  db.cves.ensure_index( 'Modified' )
  print('success to create index on cves Modified')
except Exception:
  print('failed to create index on cves Modified')
  traceback.print_exc()
  print('=======')
  pass

try:
  db.vfeed.ensure_index( 'id' )
  print('success to create index on vfeed')
except Exception:
  print('failed to create index on vfeed')
  traceback.print_exc()
  print('=======')
  pass

try:
  db.vendor.ensure_index( 'id' )
  print('success to create index on vendor')
except Exception:
  print('failed to create index on vendor')
  traceback.print_exc()
  print('=======')
  pass

try:
  db.d2sec.ensure_index( 'id' )
  print('success to create index on d2sec')
except Exception:
  print('failed to create index on d2sec')
  traceback.print_exc()
  print('=======')
  pass

try:
  db.mgmt_whitelist.ensure_index( 'id' )
  print('success to create index on mgmt_whitelist')
except Exception:
  print('failed to create index on mgmt_whitelist')
  traceback.print_exc()
  print('=======')
  pass

try:
  db.mgmt_blacklist.ensure_index( 'id' )
  print('success to create index on mgmt_blacklist')
except Exception:
  print('failed to create index on mgmt_blacklist')
  traceback.print_exc()
  print('=======')
  pass

